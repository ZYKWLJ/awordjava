# 一、问题：

 购票系统中，如果加入购物车后，用户一直不付款，**等待10min后，会直接取消预付款资格**。
 这种 在一段时间以后才执行的业务称为**延迟任务**，最简单的实现就是 **利用mq的延迟消息**了。


 # 二、解决方案：
 ## (一)死信交换机+TTL
 ### 1.由来：
  所谓死信交换机，就是**装死信的交换机**。
   如果一个队列中的消息已经成为死信，并且这个队列通过**dead-letter-exchange属性**指定了一个交换机，那么队列中的死信就会**投递到这个交换机**中，而这个**交换机就称为死信交换机**。

### 2.死信
   消费者使用basic.reject或 basic.nack声明消费失败，并且消息的requeue参数设置为false消息是一个过期消息，超时无人消费要投递的队列消息满了，无法投递

### 3.作用：
#### 一、作为最终兜底方案
   1.  收集那些**因处理失败而被拒绝**的消息 
   2.  收集那些**因队列满了而被拒绝的消息** 


#### 二、实现延迟消息
   3.  收集因**TTL（有效期）到期的消息**（购票取消系统）
    
详细流程：消息路由到queue1中，设置TTL=5s，**故意不设置消费者绑定queue1，消息没有被消费**。成为死信，**被路由到死信交换机**。 此时再在绑定死信交换机的queue2之中防止消费者监听，**成功监听到，但已经是5s后了**


 ## (二)延迟消息插件
 申明延迟交换机，发送延迟消息····