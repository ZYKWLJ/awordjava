<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x4e00;&#x53e5;&#x8bdd;:&#x4ece;&#x8282;&#x70b9;&#x5411;&#x4e3b;&#x8282;&#x70b9;&#x6536;&#x655b;&#xff01;","children":[{"content":"&#x4e00;&#x3001;&#x89d2;&#x8272;&#x8f6c;&#x6362;","children":[{"content":"0.&#x5982;&#x4f55;&#x8f6c;&#x5316;&#x4e3a;&#x4e3b;&#x8282;&#x70b9;&#xff1f;","children":[],"payload":{"tag":"h3","lines":"2,3"}},{"content":"1.&#x4e09;&#x79cd;&#x72b6;&#x6001;","children":[{"content":"<pre data-lines=\"11,17\"><code class=\"language-C\">F-&gt;C:&#x8d85;&#x65f6;&#xff0c;&#x53d1;&#x8d77;&#x9009;&#x4e3e;\nC-&gt;L:&#x6536;&#x5230;&#x591a;&#x6570;&#x7968;&#x5f53;&#x9009;\nL-&gt;F:&#x4efb;&#x671f;&#x843d;&#x540e;\nC-&gt;F:&#x53d1;&#x73b0;L&#x6216;&#x8005;&#x4efb;&#x671f;&#x843d;&#x540e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"11,17"}}],"payload":{"tag":"h3","lines":"3,4"}},{"content":"2.&#x89d2;&#x8272;&#x8f6c;&#x6362;&#x7684;&#x5de7;&#x8bb0;","children":[{"content":"F:","children":[{"content":"&#x89e6;&#x53d1;&#x6761;&#x4ef6;","children":[{"content":"<pre data-lines=\"27,33\"><code class=\"language-C\">1.&#x521d;&#x59cb;\n2.F-&gt;F(&#x6765;&#x81ea;L&#x7684;&#x538b;&#x8feb;&#x3001;&#x5b95;&#x673a;)\n3.C-&gt;F(&#x53d1;&#x73b0;&#x66f4;&#x9ad8;&#x4efb;&#x671f;/L&#x3001;&#x5b95;&#x673a;)\n4.L-&gt;F(&#x53d1;&#x73b0;&#x66f4;&#x9ad8;&#x4efb;&#x671f;&#x3001;&#x5b95;&#x673a;)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"27,33"}}],"payload":{"tag":"h5","lines":"26,27"}},{"content":"&#x80fd;&#x4e0d;&#x80fd;&#x6210;&#xff1f;","children":[{"content":"<pre data-lines=\"34,37\"><code class=\"language-C\">Follower&#x8282;&#x70b9;&#x6ca1;&#x6709;&#x80fd;&#x4e0d;&#x80fd;&#x6210;&#xff0c;&#x4e00;&#x5b9a;&#x6210;&#xff0c;&#x53ea;&#x662f;&#x89e6;&#x53d1;&#x6761;&#x4ef6;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"34,37"}}],"payload":{"tag":"h5","lines":"33,34"}},{"content":"&#x6210;&#x4e86;&#x5e72;&#x4ec0;&#x4e48;&#xff1f;","children":[{"content":"<pre data-lines=\"39,47\"><code class=\"language-C\">1.&#x4e09;&#x5927;&#x4ef6;&#xff1a;\n1.1 &#x4efb;&#x671f;&#x5411;&#x4e3b;&#x8282;&#x70b9;&#x9760;&#x9f50;\n1.2 &#x91cd;&#x7f6e;&#x6295;&#x7968;\n\n2.&#x6301;&#x4e45;&#x5316;&#xff1a;\n&#x5982;&#x679c;&#x4efb;&#x671f;&#x6539;&#x53d8;&#x7684;&#x8bdd;&#xff0c;&#x9700;&#x8981;&#x6301;&#x4e45;&#x5316;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"39,47"}}],"payload":{"tag":"h5","lines":"37,38"}}],"payload":{"tag":"h4","lines":"25,26"}},{"content":"C:","children":[{"content":"&#x89e6;&#x53d1;&#x6761;&#x4ef6;&#xff1f;","children":[{"content":"<pre data-lines=\"52,55\"><code class=\"language-C\">F &#x9009;&#x4e3e;&#x8d85;&#x65f6;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"52,55"}}],"payload":{"tag":"h5","lines":"51,52"}},{"content":"&#x80fd;&#x4e0d;&#x80fd;&#x6210;&#xff1f;","children":[],"payload":{"tag":"h5","lines":"55,56"}},{"content":"&#x6210;&#x4e86;&#x5e72;&#x4ec0;&#x4e48;&#xff1f;","children":[{"content":"<pre data-lines=\"59,68\"><code class=\"language-C\">1.&#x4e09;&#x5927;&#x4ef6;&#xff1a;\n1.1 &#x91cd;&#x7f6e;&#x9009;&#x4e3e;&#x65f6;&#x949f;(&#x672c;&#x6765;&#x5c31;&#x662f;&#x65f6;&#x949f;&#x8d85;&#x65f6;&#x4e86;&#x6210;&#x4e3a;&#x7684;&#xff0c;&#x90a3;&#x5f53;&#x7136;&#x9700;&#x8981;&#x91cd;&#x7f6e;&#x65f6;&#x949f;)(&#x671f;&#x5f85;&#x4e0b;&#x4e00;&#x6b21;&#x9009;&#x4e3e;&#x6210;&#x4e3a;L)\n1.2 &#x4efb;&#x671f;+1\n1.3 &#x6295;&#x81ea;&#x5df1;&#x4e00;&#x7968;\n\n2.&#x6301;&#x4e45;&#x5316;&#xff1a;\n&#x4e00;&#x5b9a;&#x4f1a;&#x6301;&#x4e45;&#x5316;&#xff01;&#x56e0;&#x4e3a;&#x4e09;&#x5927;&#x4ef6;&#x81f3;&#x5c11;&#x6709;&#x4efb;&#x671f;&#x53d8;&#x5316;&#x4e86;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"59,68"}}],"payload":{"tag":"h5","lines":"57,58"}}],"payload":{"tag":"h4","lines":"50,51"}},{"content":"L:","children":[{"content":"&#x89e6;&#x53d1;&#x6761;&#x4ef6;&#xff1f;","children":[{"content":"<pre data-lines=\"71,74\"><code class=\"language-C\">&#x672c;&#x8eab;&#x662f;C&#x7684;&#x524d;&#x63d0;&#x4e0b;&#x591a;&#x6570;&#x6295;&#x7968;&#x8d5e;&#x540c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"71,74"}}],"payload":{"tag":"h5","lines":"70,71"}},{"content":"&#x80fd;&#x4e0d;&#x80fd;&#x6210;&#xff1f;","children":[{"content":"<pre data-lines=\"75,81\"><code class=\"language-C\">&#x8d5e;&#x540c;&#x7684;&#x6761;&#x4ef6;&#xff1a;\n1.&#x4efb;&#x671f;&#x6700;&#x9ad8;\n2.&#x65e5;&#x5fd7;&#x6700;&#x65b0;\n3.&#x8282;&#x70b9;&#x672c;&#x8eab;&#x6ca1;&#x6295;&#x8fc7;&#x7968;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"75,81"}}],"payload":{"tag":"h5","lines":"74,75"}},{"content":"&#x6210;&#x4e86;&#x5e72;&#x4ec0;&#x4e48;&#xff1f;","children":[{"content":"<pre data-lines=\"84,94\"><code class=\"language-C\">1.&#x6536;&#x655b;&#x524d;&#x7684;&#x51c6;&#x5907;&#x5de5;&#x4f5c;&#xff1a;\n1.1&#x91cd;&#x7f6e;&#x5df2;&#x5339;&#x914d;&#x3001;&#x5f85;&#x5339;&#x914d;&#x4e0b;&#x6807;&#xff1a;\ncommitIndex=0&#x3001;nextIndex=log.size()\n\n2.&#x6b63;&#x5f0f;&#x6536;&#x655b;\n2.1&#x5fc3;&#x8df3;&#x5faa;&#x73af;&#x3002;&#x540e;&#x53f0;&#x7ebf;&#x7a0b;&#x7b49;&#x95f4;&#x9694;&#x7684;&#x53d1;&#x9001;&#x5fc3;&#x8df3;/&#x590d;&#x5236;&#x65e5;&#x5fd7;replicationTicker\n2.2&#x6bcf;&#x6b21;replicationTicker&#x65f6;&#xff0c;&#x68c0;&#x6d4b;&#x4e0a;&#x4e0b;&#x6587;&#xff0c;&#x5177;&#x4f53;&#x6765;&#x8bf4;&#x662f;&#x68c0;&#x6d4b;&#x81ea;&#x5df1;&#x8fd8;&#x662f;&#x4e0d;&#x662f;&#x5f53;&#x524d;&#x7684;Leader&#xff0c;&#x4e0d;&#x662f;&#x5c31;&#x7acb;&#x5373;&#x9000;&#x51fa;loop\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"84,94"}}],"payload":{"tag":"h5","lines":"82,83"}}],"payload":{"tag":"h4","lines":"69,70"}}],"payload":{"tag":"h3","lines":"18,19"}}],"payload":{"tag":"h2","lines":"1,2"}},{"content":"&#x4e8c;&#x3001;&#x5fc3;&#x8df3;&#x903b;&#x8f91;(&#x6536;&#x655b;+&#x538b;&#x5236;)","children":[{"content":"<pre data-lines=\"96,105\"><code class=\"language-c\">&#x548c;&#x9009;&#x4e3e;&#x903b;&#x8f91;&#x76f8;&#x5bf9;&#xff0c;&#x6211;&#x4eec;&#x4e5f;&#x5206;&#x4e09;&#x4e2a;&#x5c42;&#x6b21;&#x6765;&#x5b9e;&#x73b0; RPC &#x53d1;&#x9001;&#x65b9;&#xff1a;&#x200b;    \n\n1. &#x5fc3;&#x8df3; Loop&#xff1a;&#x5728;**&#x5f53;&#x9009; Leader &#x540e;&#x8d77;&#x4e00;&#x4e2a;&#x540e;&#x53f0;&#x7ebf;&#x7a0b;**&#xff0c;&#x7b49;**&#x95f4;&#x9694;&#x7684;&#x53d1;&#x9001;&#x5fc3;&#x8df3;/&#x590d;&#x5236;&#x65e5;&#x5fd7;**&#xff0c;&#x79f0;&#x4e3a; replicationTicker&#x200b;    \n\n2. &#x5355;&#x8f6e;&#x5fc3;&#x8df3;&#xff1a;&#x5bf9;**&#x9664;&#x81ea;&#x5df1;&#x5916;&#x7684;&#x6240;&#x6709; Peer &#x53d1;&#x9001;&#x4e00;&#x4e2a;&#x5fc3;&#x8df3; RPC**&#xff0c;&#x79f0;&#x4e3a; startReplication&#x200b;\n\n3. &#x5355;&#x6b21; RPC&#xff1a;&#x5bf9;&#x67d0;&#x4e2a; Peer &#x6765;&#x53d1;&#x9001;&#x5fc3;&#x8df3;&#xff0c;&#x5e76;&#x4e14;&#x5904;&#x7406; RPC &#x8fd4;&#x56de;&#x503c;&#xff0c;&#x79f0;&#x4e3a; replicateToPeer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"96,105"}}],"payload":{"tag":"h2","lines":"95,96"}},{"content":"&#x4e09;&#x3001;&#x65e5;&#x5fd7;&#x540c;&#x6b65;","children":[{"content":"&#x7efc;&#x8ff0;&#xff1a;","children":[{"content":"<pre data-lines=\"108,117\"><code class=\"language-c\">&#x4e4b;&#x524d; PartA &#x662f;&#x6ca1;&#x6709;&#x52a0;&#x65e5;&#x5fd7;&#x7684;&#xff0c;&#x4ec5;&#x4ec5;&#x662f;&#x9009;&#x4e3e;&#xff0c;&#x73b0;&#x5728;&#x5728;&#x5fc3;&#x8df3;&#x91cc;&#x9762;&#x52a0;&#x5165;&#x65e5;&#x5fd7;&#x3002;&#x5373;&#xff1a;&#x200b;    \n\n1. &#x5728;&#x8fdb;&#x884c;&#x9886;&#x5bfc;&#x8005;&#x9009;&#x4e3e;&#x65f6;&#xff0c;&#x8981;&#x52a0;&#x5165;&#x65e5;&#x5fd7;&#x7684;&#x6bd4;&#x8f83;&#x3002;&#x200b;    \n\n2. &#x9886;&#x5bfc;&#x8005;&#x6536;&#x5230;&#x5e94;&#x7528;&#x5c42;&#x53d1;&#x6765;&#x65e5;&#x5fd7;&#x540e;&#xff08;raft.Start&#xff09;&#xff0c;&#x8981;&#x901a;&#x8fc7;**&#x5fc3;&#x8df3;&#x540c;&#x6b65;&#x7ed9;&#x6240;&#x6709; Follower**&#x3002;&#x200b;    \n\n3. &#x5728;&#x6536;&#x5230;&#x591a;&#x6570; Follower **&#x540c;&#x6b65;&#x6210;&#x529f;**&#x7684;&#x8bf7;&#x6c42;&#x540e;&#xff0c;**Leader &#x8981;&#x63a8;&#x8fdb; CommitIndex**&#xff0c;&#x5e76;&#x8ba9;&#x6240;&#x6709; **Peer Apply**&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"108,117"}}],"payload":{"tag":"h3","lines":"107,108"}},{"content":"&#x8be6;&#x7ec6;&#x60c5;&#x51b5;&#xff1a;","children":[{"content":"<pre data-lines=\"118,123\"><code class=\"language-c\">&#x603b;&#x4f53;&#x4e0a;&#x6765;&#x8bf4;&#xff0c;Leader &#x9700;&#x8981;&#x7ef4;&#x62a4;&#x4e00;&#x4e2a;&#x5404;&#x4e2a; Peer &#x7684;**&#x8fdb;&#x5ea6;&#x89c6;&#x56fe;&#xff08;nextIndex &#x548c; matchIndex &#x6570;&#x7ec4;&#xff09;**&#x3002;\n&#x5176;&#x4e2d; nextIndex &#x7528;&#x4e8e;&#x8fdb;&#x884c;&#x65e5;&#x5fd7;&#x540c;&#x6b65;&#x65f6;&#x7684;**&#x5339;&#x914d;&#x70b9;&#x8bd5;&#x63a2;**&#xff0c;matchIndex &#x7528;&#x4e8e;**&#x65e5;&#x5fd7;&#x540c;&#x6b65;&#x6210;&#x529f;&#x540e;&#x7684;&#x5339;&#x914d;&#x70b9;&#x8bb0;&#x5f55;**&#x3002;\n&#x4f9d;&#x636e;&#x5168;&#x5c40;&#x5339;&#x914d;&#x70b9;&#x5206;&#x5e03;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x8ba1;&#x7b97;&#x51fa;&#x5f53;&#x524d;&#x5168;&#x5c40;&#x7684; commitIndex&#xff0c;&#x7136;&#x540e;&#x518d;&#x901a;&#x8fc7;&#x4e4b;&#x540e;&#x8f6e;&#x6b21;&#x7684;&#x65e5;&#x5fd7;&#x590d;&#x5236; RPC &#x4e0b;&#x53d1;&#x7ed9;&#x5404;&#x4e2a; Follower&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"118,123"}}],"payload":{"tag":"h3","lines":"117,118"}}],"payload":{"tag":"h2","lines":"106,107"}},{"content":"&#x56db;&#x3001;&#x65e5;&#x5fd7;&#x5feb;&#x7167;&#x538b;&#x7f29;","children":[{"content":"&#x539f;&#x59cb;&#x7cfb;&#x7edf;&#x7684;&#x95ee;&#x9898;","children":[{"content":"<pre data-lines=\"126,133\"><code class=\"language-c\">&#x4e8e;&#x4e00;&#x4e2a;&#x957f;&#x65f6;&#x95f4;&#x8fd0;&#x884c;&#x7684; Raft &#x7cfb;&#x7edf;&#xff0c;&#x5982;&#x679c;&#x6301;&#x7eed;&#x6536;&#x5230;&#x65e5;&#x5fd7;&#xff0c;&#x4f1a;&#x9047;&#x5230;&#x4ee5;&#x4e0b;&#x95ee;&#x9898;&#xff1a;&#x200b;    \n\n1. &#x7a7a;&#x95f4;&#x4e0d;&#x591f;&#xff1a;&#x5982;&#x679c;&#x65e5;&#x5fd7;&#x65e0;&#x9650;&#x8ffd;&#x52a0;&#x4e0b;&#x53bb;&#xff0c;&#x672c;&#x5730;&#x786c;&#x76d8;&#x7a7a;&#x95f4;&#x53ef;&#x80fd;&#x5b58;&#x4e0d;&#x4e0b;&#x3002;&#x200b;    \n\n2. &#x91cd;&#x542f;&#x8fc7;&#x6162;&#xff1a;&#x56e0;&#x4e3a;&#x91cd;&#x542f;&#x65f6;&#x9700;&#x8981;&#x91cd;&#x653e;&#xff08; replay&#xff09;&#x6240;&#x6709;&#x65e5;&#x5fd7;&#xff0c;&#x5982;&#x679c;&#x65e5;&#x5fd7;&#x8fc7;&#x957f;&#xff0c;&#x91cd;&#x653e;&#x8fc7;&#x7a0b;&#x5c06;&#x4f1a;&#x6301;&#x7eed;&#x5f88;&#x4e45;&#x4e0d;&#x80fd;&#x6b63;&#x5e38;&#x5bf9;&#x5916;&#x63d0;&#x4f9b;&#x670d;&#x52a1;&#x3002;&#x200b;    \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"126,133"}}],"payload":{"tag":"h3","lines":"125,126"}},{"content":"&#x5feb;&#x7167;&#x7684;&#x4f18;&#x70b9;&#x2014;&#x2014;&#x4ece;&#x8bb0;&#x5f55;&#x5168;&#x90e8;&#x5230;&#x8bb0;&#x5f55;&#x4fee;&#x6539;&#x7684;&#x4f18;&#x5316;","children":[{"content":"<pre data-lines=\"135,145\"><code class=\"language-c\">&#x4e00;&#x4e2a;&#x7ecf;&#x5178;&#x7684;&#x89e3;&#x51b3;&#x529e;&#x6cd5;&#x662f;&#xff0c;**&#x5b9a;&#x671f;&#x5bf9;&#x65e5;&#x5fd7;&#x505a;&#x5feb;&#x7167;&#xff08;snapshot&#xff09;**\n\n&#x9488;&#x5bf9;&#x67d0;&#x4e2a;&#x65e5;&#x5fd7; entry &#x505a;&#x4e86;&#x5feb;&#x7167;&#x4e4b;&#x540e;&#xff0c;&#x8be5; entry &#x4ee5;&#x53ca;&#x4ee5;&#x524d;&#x7684;&#x65e5;&#x5fd7;&#x53d8;&#x90fd;&#x53ef;&#x4ee5;**&#x88ab;&#x622a;&#x65ad;**&#xff08;truncate&#xff09;&#x3002;\n&#x5f53;&#x7136;&#xff0c;&#x8fd9;&#x79cd;&#x65b9;&#x6cd5;&#x80fd;&#x89e3;&#x51b3;&#x7684;&#x6211;&#x4eec;&#x4e0a;&#x9762;&#x4e24;&#x4e2a;&#x95ee;&#x9898;&#x7684;&#x672c;&#x8d28;&#x539f;&#x56e0;&#x5728;&#x4e8e;&#xff1a;\n\n&#x76f8;&#x6bd4;&#x65e5;&#x5fd7;&#xff0c;**&#x5feb;&#x7167;&#x7684;&#x5b58;&#x50a8;&#x66f4;&#x4e3a;&#x7d27;&#x51d1;**&#x3002;&#x65e5;&#x5fd7;&#x8bb0;&#x5f55;&#x7684;&#x662f;&#x4e8b;&#x4ef6;&#xff08;&#x6bd4;&#x5982; update k1 = v2&#xff09;&#xff0c;\n&#x800c;&#x5feb;&#x7167;&#x901a;&#x5e38;&#x8bb0;&#x5f55;&#x7684;&#x662f;&#x6570;&#x636e;&#x6761;&#x76ee;&#xff08;&#x6bd4;&#x5982; {k1: v1, k2: v2}&#xff09;&#xff0c;&#x800c;**&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x6761;&#x76ee;&#x901a;&#x5e38;&#x4f1a;&#x5728;&#x4e8b;&#x4ef6;&#x4e2d;&#x51fa;&#x73b0;&#x591a;&#x6b21;**\n&#xff08;&#x5199;&#x5165;-&#x66f4;&#x65b0;-&#x5220;&#x9664;&#x7b49;&#x7b49;&#xff09;&#xff0c;&#x56e0;&#x6b64;&#x4ece;**&#x65e5;&#x5fd7;&#x5230;&#x5feb;&#x7167;&#x901a;&#x5e38;&#x4f1a;&#x6709;&#x538b;&#x7f29;&#x7a7a;&#x95f4;**&#x3002;(&#x4ece;&#x4e00;&#x4e2a;&#x8bb0;&#x5f55;&#x5168;&#x90e8;&#x5230;&#x53ea;&#x8bb0;&#x5f55;&#x4fee;&#x6539;&#x7684;&#x4f18;&#x5316;)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"135,145"}}],"payload":{"tag":"h3","lines":"134,135"}}],"payload":{"tag":"h2","lines":"124,125"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
