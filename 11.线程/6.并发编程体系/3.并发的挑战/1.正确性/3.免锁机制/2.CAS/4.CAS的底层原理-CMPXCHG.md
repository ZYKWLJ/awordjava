## CAS（Compare And Swap，比较并交换）——寄存器的比较再交换！

CAS是一种实现无锁同步的关键机制，用于确保多线程环境中对共享变量的原子操作。
CAS 的底层通常依赖于**处理器提供的原子指令**，例如在 **x86 架构下使用的 CMPXCHG 指令**。下面是对 CMPXCHG 指令的详细解释。


## 1. CMPXCHG 指令的基本原理：

CMPXCHG（Compare and Exchange）指令的基本原理是：

**比较内存中的某个值与寄存器中的值，如果它们相等，则将另一个寄存器中的新值存入该内存位置**。

如果不相等，则不更新内存，而是将内存中的值复制到寄存器中。这个过程是原子性的，即不可分割的，中间不会被其他线程打断。

## 2. CMPXCHG 指令的操作步骤：

CMPXCHG 指令通常涉及以下三个操作数：

目的操作数（内存地址）：需要比较并可能更新的内存位置。
比较操作数（寄存器EAX）：存储当前期望的值。
交换操作数（寄存器）：存储要更新的新值。
具体步骤如下：

比较：比较目的操作数（内存地址中的值）与寄存器EAX中的值。
如果它们相等，则将交换操作数（寄存器中的新值）存入内存地址，完成更新。
如果不相等，则不更新内存，而是将内存地址中的值复制到寄存器EAX中。
更新：如果比较成功，更新内存；如果比较失败，则返回当前的内存值，供程序重新判断和操作。


## 3. CMPXCHG 指令的示例：
假设我们要更新一个内存地址中的值，如果它当前的值是5，那么我们将其更新为10。