# 一、并发安全问题的充要条件：
1.同时操作共享变量(临界区)

2.至少有一个写

3.没有使用互斥机制


# 二、导致的本质问题

## 1.原子性

 一个线程在CPU中操作不可暂停，也不可中断，要不执行完成，要不不执行
 举例
  ### 超卖问题
   线程 1 先查询到库存大于 1 准备扣减，还未完成扣减时线程 2 也进行了查询这说明“**查询库存并扣减库存”这个操作不是原子的**，被分割成了“查询”和“扣减”两个独立的操作步骤，

## 2.可见性

 让一个线程对共享变量的修改**立即对另一个线程可见**

## 3.有序性

 指令重排：**处理器与编译器为了提高程序运行效率，可能会对输入代码进行优化**，它**不保证程序中各个语句的执行先后顺序同代码中的顺序一致**，但是它会保证程序最终执行结果和代码顺序执行的结果是一致的。

 所以在单线程中没关系，这也叫**as-if-serial定理**，**即保证单线程一致性**。
 但是在多线程中就会出错！