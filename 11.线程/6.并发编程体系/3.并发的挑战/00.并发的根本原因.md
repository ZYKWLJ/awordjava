# 一、并发安全问题的充要条件：
1.同时操作共享变量(临界区)

2.至少有一个写

3.没有使用互斥机制


# 二、导致的本质问题

## 1.原子性

 一个线程在CPU中操作不可暂停，也不可中断，要不执行完成，要不不执行
 举例
  ### 超卖问题
   线程 1 先查询到库存大于 1 准备扣减，还未完成扣减时线程 2 也进行了查询这说明“**查询库存并扣减库存”这个操作不是原子的**，被分割成了“查询”和“扣减”两个独立的操作步骤，

## 2.可见性

 让一个线程对共享变量的修改**立即对另一个线程可见**

## 3.有序性

 指令重排：**处理器与编译器为了提高程序运行效率，可能会对输入代码进行优化**，它**不保证程序中各个语句的执行先后顺序同代码中的顺序一致**，但是它会保证程序最终执行结果和代码顺序执行的结果是一致的。

 所以在单线程中没关系，这也叫**as-if-serial定理**，**即保证单线程一致性**。
 但是在多线程中就会出错！


# 三.竞态条件

## 1.定义
在大多数实际的多线程应用中，**两个或两个以上**的需要共享同一对数据数据的存取。如果**两个线程存取同一个对象**，并且两个线程**修改该对象状态的方法**，会发生覆盖现象，导致数据不一致。这取决于线程访问和数据的次序，可能导致对象被破坏，这称为竞态条件。

还是第一点的本质问题！

# 四.临界区
访问共享资源的程序片段